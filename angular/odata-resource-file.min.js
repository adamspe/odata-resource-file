/*
 * odata-resource-file
 * Version: 0.1.0 - 2016-03-13
 */
angular.module("odata-resource-file",["templates-odata-resource-file","ngResource"]).provider("$fileResource",[function(){this.$get=["$log","$resource","$http",function(a,b,c){return function(c){var d=b(c,{},{get:{method:"GET"},query:{method:"GET",isArray:!1},save:{method:"POST",transformRequest:function(b,c){a.debug("$fileResource.transformRequest",b,c);var d=b.file,e=new FormData;return c={"Content-Type":void 0},e.append("file",d),e},headers:{"Content-Type":void 0}}});return d}}]}]).directive("fileModel",["$log","$parse","$injector",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(b){a.debug("fileModel.listenForChange.ImageResource",b),e.unbind("change"),e.bind("change",function(){d.$apply(function(){var c=e[0].files[0],f=b?new b({file:c}):c;a.debug("file changed to",c,f),i(d,f)})})}var h=b(f.fileModel),i=h.assign;f.$observe("fileResource",function(e){var h=f.fileResource?b(f.fileResource)(d):void 0;a.debug("$attrs.fileResource",h),"string"==typeof h?c.invoke([h,g]):g(h)})}}}]).directive("imgDisplay",[function(){return{restrict:"E",template:'<img ng-src="{{image._links[format]}}" />',scope:{image:"=",format:"@imageFormat"}}}]).directive("imgUpload",["$log",function(a){return{restrict:"E",template:'<input type="file" file-model="imageToUpload" file-resource="callerResource" />',scope:{callerResource:"=imageResource",onUpload:"&"},link:function(b){b.$watch("imageToUpload",function(){a.debug("imageToUpload",b.imageToUpload),b.imageToUpload&&(b.imageToUpload.$save?b.imageToUpload.$save(function(c){a.debug("uploaded",c),b.onUpload({image:c})}):a.debug("received non resource file change (missing image-resource)",b.imageToUpload))})}}}]).directive("imgControl",["$log","$parse",function(a,b){return{restrict:"E",templateUrl:"js/image-control.html",scope:{callerResource:"=imageResource",format:"@imageFormat"},link:function(c,d,e){var f;c.theImage=void 0,c.onUpload=function(b){a.debug("imgControl.onUpload",b),c.theImage=b,f&&f.assign(c.$parent,b)},c.remove=function(){c.theImage.$remove({id:c.theImage._id},function(){c.theImage=void 0,f&&f.assign(c.$parent,void 0)})},e.$observe("image",function(d){a.debug("$observe.image",d),f=b(d),c.theImage=f(c.$parent)})}}}]),angular.module("templates-odata-resource-file",["js/image-control.html"]),angular.module("js/image-control.html",[]).run(["$templateCache",function(a){a.put("js/image-control.html",'<div class="image-control">\n    <div class="image-display" ng-if="theImage">\n        <a href class="image-remove" ng-click="remove()"><i class="fa fa-times-circle-o"></i></a>\n        <img-display image="theImage" image-format="{{format}}"></img-display>\n    </div>\n    <div class="image-upload">\n        <img-upload ng-if="!theImage" image-resource="callerResource" on-upload="onUpload(image)"></img-upload>\n    </div>\n</div>')}]);